### 浏览器渲染原理

1.构建 DOM 树
  - 就是把标签变成一棵树

2.样式计算 Style

  - 2.1 把 CSS 转换为浏览器能够理解的结构
    - 就是把 link css/style css/ style='xx' 这三种全部变成 styleSheets
  - 2.2 转换样式值
    - 把 blue 变成 rgb 值
  - 2.3 计算 DOM 树中的节点的具体样式

    - css 继承，继承父级节点的样式 如 font-size
    - css 层叠

3.布局阶段 Layout

  - 3.1 创建布局树 LayoutTree
    - 忽略隐藏的元素 找到所有可见元素
    - 忽略 head 下所有内容
  - 3.2 布局计算

    - 找到布局树节点元素的坐标位置

4.分层 Layer

  - 绘制图层树 LayerTree
  - 什么情况会单独抽出一层？
  - 有层叠上下文的属性 fixed/z-index/filter/opacity
  - 需要裁剪的地方 比如文字超出盒子/ 出现滚动条

5.绘制图层 Paint

  - 就是把图层绘制变成一个个指令

    - 比如 画方形红色坐标 xy / 画圆形蓝色坐标 x1y1 变成一个绘制顺序和绘制指令的列表映射

6.栅格化操作
  - 主线程(前面 5 步)一次性 commit 给合成线程
  - 会把整张长页面变成一个个图块
  - 图块需要变成位图，叫做栅格化
  - 渲染进程会维护一个栅格化线程池，里面一个个栅格化线程

  - 一个栅格化过程会去 GPU 进程中生成位图然后保存在 GPU 内存中

7.合成和显示
  - 光栅化结束，合成线程生成一个绘制图块的命令 
  - DrawQuad 给浏览器进程
  - 浏览器进程里的 viz 组件接收命令，然后将页面内容渲染出来